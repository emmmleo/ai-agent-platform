## 功能目标
- 支持已登录用户自助查看与编辑个人资料：学校、电话号码、邮箱（可选）、个性签名（可选）。
- 前端提供「个人信息」页面，含表单校验、保存成功/失败反馈；保存后刷新全局用户信息。
- 后端提供安全的读取/更新接口，仅允许用户修改自己的资料，审计 `updatedAt`。

## 后端改造
- 扩展实体与DTO
  - `backend/src/main/java/com/aiagent/user/entity/User.java`：新增 `school`, `phone`, `email`(可选), `bio`(可选) 字段。
  - `backend/src/main/java/com/aiagent/user/dto/UserProfileResponse.java`：新增同上字段，供前端展示。
  - 新增 `UserProfileUpdateRequest` DTO：可选字段 `school`, `phone`, `email`, `bio`；带校验注解。
- Mapper与Service
  - `UserMapper` 与 `UserMapper.xml`：新增针对上述字段的 `updateProfile` SQL，仅更新非空字段并维护 `updated_at`。
  - `UserService`：新增 `updateProfile(String username, UserProfileUpdateRequest req)`，内部做格式校验与归一化（如电话清洗）。
- 控制器
  - `UserController`：
    - 保留现有 `GET /v1/user/profile` 返回扩展后的 `UserProfileResponse`。
    - 新增 `PATCH /v1/user/profile` 接收 `UserProfileUpdateRequest`，从 `Authentication` 解析当前用户，仅更新自己的资料。

## 安全与权限
- 认证：沿用现有 JWT；接口需认证（保留匿名仅限登录/注册）。
- 授权：`PATCH /v1/user/profile` 不需要管理员权限，但必须与 token 中用户名一致；后端强制校验防止越权。
- 输入安全：后端开启 Bean Validation；对 `bio` 等文本进行长度限制与危险字符过滤，防止存储型 XSS。
- 速率控制（可选）：为资料更新接口设置基础限流，防止滥用。

## 数据库与迁移
- 表结构：为 `users` 表新增列 `school VARCHAR(128)`, `phone VARCHAR(32)`, `email VARCHAR(128) NULL`, `bio VARCHAR(512) NULL`。
- 迁移脚本：新增 SQL migration（按当前项目约定：MyBatis XML或独立 `db/migrations` 脚本）。
- 索引（可选）：`email` 若需唯一登录，可添加唯一索引；当前不强制。

## 校验规则
- `school`：长度 1–128。
- `phone`：E.164 格式（示例 `+8613800138000`），或国内 11 位；统一存储为清洗后的数字/带国家码。
- `email`：标准邮箱格式，长度 ≤128。
- `bio`：长度 ≤512，剔除控制字符。

## 前端改造
- 路由与页面
  - 新增路由：`/account/profile`（名称：个人信息）。
  - 新增页面组件：`frontend/src/views/AccountProfile.vue`，包含资料表单与保存按钮。
- API 与状态
  - `frontend/src/api/user.ts`：新增 `updateUserProfile(payload)` 调用 `PATCH /v1/user/profile`；扩展 `UserProfile` 类型字段。
  - `frontend/src/stores/user.ts`：保存成功后重新调用 `getUserProfile()` 更新全局用户信息。
- 表单与校验
  - 使用现有 UI/校验库（沿用项目栈；若未集成则使用轻量规则实现）。
  - 字段：学校（输入框）、电话（输入框，格式校验）、邮箱（输入框，格式校验，可选）、个性签名（多行）。
  - 交互：提交加载态、错误提示、成功提示；离开页面前未保存提醒（可选）。

## 接口契约
- `GET /v1/user/profile`
  - 响应：`{ id, username, role, createdAt, updatedAt, school, phone, email, bio }`
- `PATCH /v1/user/profile`
  - 请求体：`{ school?: string, phone?: string, email?: string, bio?: string }`
  - 响应：更新后的 `UserProfileResponse`。

## 测试与验收
- 后端：
  - Service 单测：字段校验、越权更新拒绝、部分字段更新、空值不覆盖。
  - 控制器集成测：带 JWT 的正常更新与 401/403 场景；数据库断言。
- 前端：
  - 组件测试：表单校验与提交流程；错误提示与成功刷新用户状态。
  - API Mock：模拟 200/4xx 响应。

## 兼容与发布
- 兼容：老数据默认空字段；前端在空值时显示占位文案。
- 发布顺序：先迁移数据库→后端上线→前端上线；支持灰度。
- 回滚：前端可快速隐藏入口；后端保留接口但限制更新；数据库列保留不删。

## 里程碑
1) 数据库与后端模型/接口实现
2) 前端页面与交互实现
3) 自动化测试与验收
4) 上线与监控

请确认是否按此方案执行，或告知是否需要增减字段（如地址、头像上传等）。